server {
	listen 80 default_server;
	server_name _;

	{% if inventory_hostname in groups['web_servers'] -%}
	location / {
		uwsgi_pass localhost:5000;
		include uwsgi_params;
	}
	{% endif %}

	{% if inventory_hostname in groups['prometheus'] -%}
	location /prometheus  {
	    proxy_pass http://localhost:9090;
        }
	{% endif %}
	
	{% if inventory_hostname in groups['grafana'] -%}
        location  ~^/grafana(.*){
            proxy_pass http://localhost:3000;
	    proxy_set_header Host $http_host;
        }
	{% endif %}
}


server {
    listen 8080 default_server;
    location = /stub_status {
        stub_status;
    }
}

